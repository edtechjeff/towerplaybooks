---
- name: to check WSUS server if patches are waiting to be approved
  hosts: "{{ ansible_play_batch }}"
  gather_facts: false
  tasks:
  - name: Check Critical Updates
    win_shell:
       Get-WsusUpdate -Classification critical -Approval AnyExceptDeclined -Status Needed
    register: updates
  - name: Critical Updates Needed Approved
    debug:
      var: updates.stdout_lines
  - name: Check Security Updates
    win_shell:
       Get-WsusUpdate -Classification security -Approval AnyExceptDeclined -Status Needed
    register: updates
  - name: Security Updates Needed Approved
    debug:
      var: updates.stdout_lines
  - name: Checking for all Updates Needed
   win_shell:
       Get-WsusUpdate -Classification All -Approval AnyExceptDeclined -Status Needed
    register: updates
  - name: All Updates Needed Approved
    debug:
      var: updates.stdout_lines
